!function(){"use strict";angular.module("app._common",["lbServices","angular-google-analytics","ngResource","ngSanitize","ngCookies","permission","toaster","ui.bootstrap","ui.router"])}(),function(){"use strict";function routerHelperProvider($locationProvider,$stateProvider,$urlRouterProvider){function RouterHelper($state){function configureStates(states,otherwisePath){states.forEach(function(state){var config={controllerAs:"vm"};angular.extend(config,state.config),config.views&&_.each(config.views,function(item){item.controllerAs="vm"}),$stateProvider.state(state.state,config)}),otherwisePath&&!hasOtherwise&&(hasOtherwise=!0,$urlRouterProvider.otherwise(otherwisePath))}function getStates(){return $state.get()}var hasOtherwise=!1,service={configureStates:configureStates,getStates:getStates};return service}this.$get=RouterHelper,RouterHelper.$inject=["$state"]}angular.module("app._common").provider("routerHelper",routerHelperProvider),routerHelperProvider.$inject=["$locationProvider","$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function modalHelperProvider(){function modalHelper($uibModal,$q,toaster){function configureModals(modals){var _ret={};return angular.forEach(modals,function(modal){_ret[modal.modal]=function(obj){function ModalResultComplete(response){return response}function ModalResultFailed(reason){return reason&&"backdrop click"!==reason?$q.reject():void 0}var config={controllerAs:"vm",resolve:{ModalParams:function(){return obj||{}}}};return angular.extend(config,modal.config),$uibModal.open(config).result.then(ModalResultComplete)["catch"](ModalResultFailed)}}),_ret}var service={configureModals:configureModals};return service}this.$get=modalHelper,modalHelper.$inject=["$uibModal","$q","toaster"]}angular.module("app._common").provider("modalHelper",modalHelperProvider),modalHelperProvider.$inject=[]}(),function(){"use strict";function configHelperProvider(){function ConfigHelper(){function notifyConfig(configName,message){message=message||{},console.log("%c CONFIG - "+configName+" ","background: #9C27B0; color: #FFF",message)}var service={notifyConfig:notifyConfig};return service}this.$get=ConfigHelper,ConfigHelper.$inject=[]}angular.module("app._common").provider("configHelper",configHelperProvider),configHelperProvider.$inject=[]}(),function(){"use strict";function numberFixedLen(){return function(a,b){return(1e4+a+"").slice(-b)}}angular.module("app._common").filter("numberFixedLen",numberFixedLen),numberFixedLen.$inject=[]}(),function(){"use strict";function fromNow(){return function(date){return moment(date).fromNow()}}angular.module("app._common").filter("fromNow",fromNow),fromNow.$inject=[]}(),function(){"use strict";function fileicon(){var _icons={"application/pdf":"fa-file-pdf-o","application/powerpoint":"fa-file-powerpoint-o","application/x-msword":"fa-file-word-o","application/x-msexcel":"fa-file-excel-o","application/x-mspowerpoint":"fa-file-powerpoint-o","audio/x-mpeg-3":"fa-file-audio-o","image/gif":"fa-file-image-o","image/png":"fa-file-image-o","image/tiff":"fa-file-image-o","image/jpeg":"fa-file-image-o","video/avi":"fa-file-video-o","video/mpeg":"fa-file-video-o","video/msvideo":"fa-file-video-o","video/quicktime":"fa-file-video-o","application/zip":"fa-file-zip-o"};return function(a){return _icons[a]||"fa-file-o"}}angular.module("app._common").filter("fileicon",fileicon),fileicon.$inject=[]}(),function(){"use strict";function bytes(){return function(bytes,precision){if(isNaN(parseFloat(bytes))||!isFinite(bytes))return"-";"undefined"==typeof precision&&(precision=1);var units=["bytes","kB","MB","GB","TB","PB"],number=Math.floor(Math.log(bytes)/Math.log(1024));return(bytes/Math.pow(1024,Math.floor(number))).toFixed(precision)+" "+units[number]}}angular.module("app._common").filter("bytes",bytes),bytes.$inject=[]}(),function(){"use strict";function ngPrint(){function link(scope,element,attrs){element.on("click",function(){var elemToPrint=document.getElementById(attrs.printElementId);elemToPrint&&printElement(elemToPrint)});var beforePrint=function(){console.log("Functionality to run before printing.")},afterPrint=function(){console.log("Functionality to run after printing"),printSection.innerHTML=""};if(window.matchMedia){var mediaQueryList=window.matchMedia("print");mediaQueryList.addListener(function(mql){mql.matches?beforePrint():afterPrint()})}window.onbeforeprint=beforePrint,window.onafterprint=afterPrint}function printElement(elem){var domClone=elem.cloneNode(!0);printSection.appendChild(domClone),window.print()}var printSection=document.getElementById("printSection");return printSection||(printSection=document.createElement("div"),printSection.id="printSection",document.body.appendChild(printSection)),{link:link,restrict:"A"}}angular.module("app._common").directive("ngPrint",ngPrint),ngPrint.$inject=[]}(),function(){"use strict";function errSrc(){return{link:function(scope,element,attrs){attrs.ngSrc||attrs.$set("src",attrs.errSrc),element.bind("error",function(){return"REMOVE"==attrs.errSrc?void element.remove():void(attrs.src!=attrs.errSrc&&attrs.$set("src",attrs.errSrc))})}}}angular.module("app._common").directive("errSrc",errSrc),errSrc.$inject=[]}(),function(){"use strict";function PermissionsConfig(configHelper,Permission,User){Permission.defineRole("Anonymous",function(){return!User.isAuthenticated()}),configHelper.notifyConfig("Permissions","Loaded")}angular.module("app._common").run(PermissionsConfig),PermissionsConfig.$inject=["configHelper","Permission","User"]}(),function(){"use strict";function LocationConfig(configHelperProvider,$locationProvider){$locationProvider.html5Mode(!0),configHelperProvider.$get().notifyConfig("Location HTML5",!0)}angular.module("app._common").config(LocationConfig),LocationConfig.$inject=["configHelperProvider","$locationProvider"]}(),function(){"use strict";function LocationConfig($httpProvider){$httpProvider.defaults.withCredentials=!0}angular.module("app._common").config(LocationConfig),LocationConfig.$inject=["$httpProvider"]}(),function(){"use strict";function AnalyticsConfig(configHelperProvider,AnalyticsProvider){var GoogleTrackCode="UA-4623228-21";AnalyticsProvider.setAccount(GoogleTrackCode),AnalyticsProvider.trackUrlParams(!0),AnalyticsProvider.ignoreFirstPageLoad(!0),AnalyticsProvider.setPageEvent("$stateChangeSuccess"),configHelperProvider.$get().notifyConfig("Google Analytics",GoogleTrackCode)}angular.module("app._common").config(AnalyticsConfig),AnalyticsConfig.$inject=["configHelperProvider","AnalyticsProvider"]}(),function(){"use strict";angular.module("app.settings",[])}(),function(){"use strict";function SettingsController(SettingsService,toaster){function activate(){}activate()}angular.module("app.settings").controller("SettingsController",SettingsController),SettingsController.$inject=["SettingsService","toaster"]}(),function(){"use strict";angular.module("app.plists",[])}(),function(){"use strict";function PlistsController(PlistsService,PlistsModals){function activate(){vm.LoadPlists()}function LoadPlists(){vm.loading=!0,PlistsService.GetPlists().then(function(plists){vm.Plists=plists})["finally"](function(){vm.loading=!1})}function AddPlist(){PlistsModals.PlistForm().then(function(){vm.LoadPlists()})}function ViewPlist(id){PlistsModals.PlistForm({ID:id}).then(function(){vm.LoadPlists()})}function DeletePlist(id){Plists.DeletePlist(id).then(function(){vm.LoadPlists()})}var vm=this;vm.AddPlist=AddPlist,vm.ViewPlist=ViewPlist,vm.DeletePlist=DeletePlist,vm.LoadPlists=LoadPlists,activate()}angular.module("app.plists").controller("PlistsController",PlistsController),PlistsController.$inject=["PlistsService","PlistsModals"]}(),function(){"use strict";function PlistFormController($modalInstance,ModalParams,PlistsService){function activate(){ModalParams.ID?(vm.loading=!0,PlistsService.GetPlist(ModalParams.ID).then(function(data){vm.Plist=data,0===vm.Plist.Participants.length&&vm.AddParticipants()})["finally"](function(){vm.loading=!1})):vm.AddParticipants()}function AddParticipants(){for(var i=0;5>i;i++)vm.Plist.Participants.push({})}function RemoveParticipant(index){vm.Plist.Participants.splice(index,1)}function Save(){PlistsService.SavePlist(vm.Plist).then(function(){$modalInstance.close()})}var vm=this;vm.Plist={Participants:[]},vm.AddParticipants=AddParticipants,vm.RemoveParticipant=RemoveParticipant,vm.Save=Save,activate()}angular.module("app.plists").controller("PlistFormController",PlistFormController),PlistFormController.$inject=["$modalInstance","ModalParams","PlistsService"]}(),function(){"use strict";angular.module("app.lotteries",[])}(),function(){"use strict";function LotteriesController(LotteriesService,LotteriesModals,toaster,$state){function activate(){vm.LoadLotteries().then(function(){vm.HasPages=LotteriesService.HasPages()})}function FetchPrevious(){vm.HasPages.Previous&&(LotteriesService.PreviousPage(),vm.HasPages=LotteriesService.HasPages(),vm.LoadLotteries())}function FetchNext(){vm.HasPages.Next&&(LotteriesService.NextPage(),vm.HasPages=LotteriesService.HasPages(),vm.LoadLotteries())}function LoadLotteries(){return vm.loading=!0,LotteriesService.GetLotteries().then(function(data){vm.Lotteries=data})["finally"](function(){vm.loading=!1})}function AddLottery(){LotteriesModals.LotteryInit().then(function(id){id&&$state.go("app.lotteries.lottery",{ID:id})})}function DeleteLottery(lottery){LotteriesService.DeleteLottery(lottery).then(function(){vm.LoadLotteries()})}var vm=this;vm.AddLottery=AddLottery,vm.DeleteLottery=DeleteLottery,vm.LoadLotteries=LoadLotteries,vm.FetchPrevious=FetchPrevious,vm.FetchNext=FetchNext,activate()}angular.module("app.lotteries").controller("LotteriesController",LotteriesController),LotteriesController.$inject=["LotteriesService","LotteriesModals","toaster","$state"]}(),function(){"use strict";function LotteryController(LotteriesService,$stateParams,toaster){function activate(){vm.LoadLottery()}function LoadLottery(){vm.loading=!0,LotteriesService.GetLottery($stateParams.ID).then(function(data){vm.Lottery=data})["finally"](function(){vm.loading=!1})}var vm=this;vm.LoadLottery=LoadLottery,activate()}angular.module("app.lotteries").controller("LotteryController",LotteryController),LotteryController.$inject=["LotteriesService","$stateParams","toaster"]}(),function(){"use strict";function LotteryInitController($modalInstance,ModalParams,LotteriesService,ParticipantsService){function activate(){vm.LoadPLists()}function LoadPLists(){vm.loading=!0,ParticipantsService.GetPLists().then(function(data){vm.PLists=data})["finally"](function(){vm.loading=!1})}function Save(){LotteriesService.SaveLottery(vm.Lottery).then(function(resp){$modalInstance.close(resp.id)})}var vm=this;vm.Lottery={Name:"Lottery #"+Math.floor(99999*Math.random()+1e4)},vm.LoadPLists=LoadPLists,vm.Save=Save,activate()}angular.module("app.lotteries").controller("LotteryInitController",LotteryInitController),LotteryInitController.$inject=["$modalInstance","ModalParams","LotteriesService","ParticipantsService"]}(),function(){"use strict";angular.module("app.auth",[])}(),function(){"use strict";function AuthLoginController($stateParams,$state,LoginMessages,User){function activate(){switch($stateParams.ref){case"au":vm.Alert=LoginMessages.UNAUTHORIZED;break;case"so":vm.Alert=LoginMessages.SIGNOUT;break;case"re":vm.Alert=LoginMessages.REGISTERED}}function SignIn(){vm.loading=!0,vm.Alert=!1,User.login(vm.credentials).$promise.then(function(response){$state.go("app.lotteries.overview")},function(rejection){console.log("rejection",rejection),vm.Alert=LoginMessages[rejection.error.toUpperCase()]})["finally"](function(){vm.loading=!1})}var vm=this;vm.loading=!1,vm.SignIn=SignIn,activate()}angular.module("app.auth").controller("AuthLoginController",AuthLoginController),AuthLoginController.$inject=["$stateParams","$state","LoginMessages","User"]}(),function(){"use strict";function RoutesConfig(configHelper,routerHelper){var _states=getStates();routerHelper.configureStates(_states,"/"),configHelper.notifyConfig("Basic Routes",_.map(_states,function(_state){return _state.state}))}function getStates(){return[{state:"app",config:{"abstract":!0,templateUrl:"src/_common/views/layout.html",controller:function($scope,User){User.getCurrent().$promise.then(function(u){$scope.username=u.username})}}}]}angular.module("app._common").run(RoutesConfig),RoutesConfig.$inject=["configHelper","routerHelper"]}(),function(){"use strict";function SettingsService($resource){function GetSettings(params){return $resource(APP.Service+"_design/models/_view/Settings").get().$promise.then(function(data){return _.chain(data.rows).map(function(item){return item.value}).sortBy(function(item){return item.DrewAt||0}).reverse().value()})}function GetSetting(id){return $resource(APP.Service+id).get().$promise.then(function(data){return data})}function SaveSetting(Setting){return Setting.Type="Setting",$resource(APP.Service).save(Setting).$promise.then(function(data){return data})}function DeleteSetting(Setting){return Setting._deleted=!0,Setting.DeletedAt=new Date,$resource(APP.Service).save(Setting).$promise}var service={GetSettings:GetSettings,GetSetting:GetSetting,SaveSetting:SaveSetting,DeleteSetting:DeleteSetting};return service}angular.module("app.settings").factory("SettingsService",SettingsService),SettingsService.$inject=["$resource"]}(),function(){"use strict";function appRun(routerHelper){routerHelper.configureStates(getStates())}function getStates(){return[{state:"app.settings",config:{url:"/settings",controller:"SettingsController",templateUrl:"src/settings/overview/view.html",data:{permissions:{except:["Anonymous"],redirectTo:"auth.login"}}}}]}angular.module("app.settings").run(appRun),appRun.$inject=["routerHelper"]}(),function(){"use strict";function PlistsService($resource,Plist){function GetPlists(params){return Plist.find().$promise.then(function(data){return _.sortBy(data,function(item){return item.Name})})}function GetPlist(id){return Plist.findById(id).$promise.then(function(item){return item})}function SavePlist(plist){return plist.id||(plist.CreatedAt=new Date),plist.participants=_.filter(plist.Participants,function(item){return item.Name||item.Email}),Plist.updateOrCreate(plist).$promise.then(function(item){return item})}function DeletePlist(id){return Plist.deleteById(id).$promise.then(function(item){return item})}var service={GetPlists:GetPlists,GetPlist:GetPlist,SavePlist:SavePlist,DeletePlist:DeletePlist};return service}angular.module("app.plists").factory("PlistsService",PlistsService),PlistsService.$inject=["$resource","Plist"]}(),function(){"use strict";function appRun(routerHelper){routerHelper.configureStates(getStates())}function getStates(){return[{state:"app.plists",config:{url:"/plists",controller:"PlistsController",templateUrl:"src/plists/overview/view.html"}}]}angular.module("app.plists").run(appRun),appRun.$inject=["routerHelper"]}(),function(){"use strict";function PlistsModals(modalHelper){function getModals(){return[{modal:"PlistForm",config:{templateUrl:"src/plists/form/view.html",controller:"PlistFormController",size:"md",backdrop:"static"}}]}return modalHelper.configureModals(getModals())}angular.module("app.plists").factory("PlistsModals",PlistsModals),PlistsModals.$inject=["modalHelper"]}(),function(){"use strict";function LotteriesService($resource){function NextPage(){service._offset=(service._offset/service._limit+1)*service._limit}function PreviousPage(){service._offset=(service._offset/service._limit-1)*service._limit}function HasPages(){return{Previous:0!==service._offset,Next:service._total-service._offset>service._limit}}function GetLotteries(){return $resource(APP.Service+"_design/models/_view/lotteries").get({limit:service._limit,skip:service._offset}).$promise.then(function(data){return service._total=data.total_rows,_.chain(data.rows).map(function(item){return item.value}).sortBy(function(item){return item.DrewAt||0}).reverse().value()})}function GetLottery(id){return $resource(APP.Service+id).get().$promise.then(function(data){return data})}function SaveLottery(lottery){return lottery.Type="Lottery",lottery.DrewAt=new Date,lottery.Participants=_.shuffle(lottery.Participants),$resource(APP.Service).save(lottery).$promise.then(function(data){return data})}function DeleteLottery(lottery){return lottery._deleted=!0,lottery.DeletedAt=new Date,$resource(APP.Service).save(lottery).$promise}var service={_total:null,_limit:10,_offset:0,GetLotteries:GetLotteries,GetLottery:GetLottery,SaveLottery:SaveLottery,DeleteLottery:DeleteLottery,NextPage:NextPage,PreviousPage:PreviousPage,HasPages:HasPages};return service}angular.module("app.lotteries").factory("LotteriesService",LotteriesService),LotteriesService.$inject=["$resource"]}(),function(){"use strict";function appRun(routerHelper){routerHelper.configureStates(getStates())}function getStates(){return[{state:"app.lotteries",config:{"abstract":!0,template:"<ui-view/>",data:{permissions:{except:["Anonymous"],redirectTo:"auth.login"}}}},{state:"app.lotteries.overview",config:{url:"/",controller:"LotteriesController",templateUrl:"src/lotteries/overview/view.html"}},{state:"app.lotteries.lottery",config:{url:"/lottery/:ID",controller:"LotteryController",templateUrl:"src/lotteries/lottery/view.html"}}]}angular.module("app.lotteries").run(appRun),appRun.$inject=["routerHelper"]}(),function(){"use strict";function LotteriesModals(modalHelper){function getModals(){return[{modal:"LotteryInit",config:{templateUrl:"src/lotteries/init/view.html",controller:"LotteryInitController",size:"sm"}}]}return modalHelper.configureModals(getModals())}angular.module("app.lotteries").factory("LotteriesModals",LotteriesModals),LotteriesModals.$inject=["modalHelper"]}(),function(){"use strict";function appRun(routerHelper){routerHelper.configureStates(getStates())}function getStates(){return[{state:"auth",config:{"abstract":!0,template:"<ui-view/>"}},{state:"auth.login",config:{url:"/login",params:{ref:null},templateUrl:"src/auth/login/view.html",controller:"AuthLoginController",data:{permissions:{only:["Anonymous"],redirectTo:"app.lotteries.overview"}}}},{state:"auth.logout",config:{url:"/logout",template:"<ui-view/>",controller:function(User,$state){User.logout().$promise.then(function(){})["finally"](function(){localStorage.clear(),$state.go("auth.login",{ref:"so"})})}}}]}angular.module("app.auth").run(appRun),appRun.$inject=["routerHelper"]}(),function(){"use strict";function AuthInterceptor($q,$injector,$cookies){return{responseError:function(rejection){if(401===rejection.status&&!rejection.config.IsSignIn){var User=$injector.get("User");User.logout();var $state=$injector.get("$state");$state.go("auth.login",{ref:"au"})}return $q.reject(rejection)}}}function AuthInterceptorConfig($httpProvider){$httpProvider.interceptors.push("AuthInterceptor")}angular.module("app.auth").config(AuthInterceptorConfig).factory("AuthInterceptor",AuthInterceptor),AuthInterceptor.$inject=["$q","$injector","$cookies"],AuthInterceptorConfig.$inject=["$httpProvider"]}(),function(){"use strict";angular.module("app.auth").constant("LoginMessages",{ANAUTHORIZED:{Type:"danger",Message:"You were signed out",Details:"Probably your session was timed out"},SIGNOUT:{Type:"success",Message:"You were signed out",Details:"You may login again using the form"},REGISTERED:{Type:"success",Message:"Your account is ready, you can login now",Details:!1},AUTHERROR:{Type:"danger",Message:"Authentication Error",Details:null},UNAVAILABLE:{Type:"danger",Message:"Service is not available",Details:"Please try again later. If the problem insist, contact your system administrator"},UNAUTHORIZED:{Type:"danger",Message:"Name or password is incorrect",Details:"Please try again"}})}(),function(){"use strict";angular.module("app",["app.auth","app.lotteries","app.plists","app.settings","app._common"])}(),function(){"use strict";function appRun($rootScope,$state,$stateParams){$rootScope.APP=APP,$rootScope.$on("$stateChangeStart",function(evt,to,params){to.redirectTo&&(evt.preventDefault(),$state.go(to.redirectTo,params))})}angular.module("app").run(appRun),appRun.$inject=["$rootScope","$state","$stateParams"]}(),function(){"use strict";window.APP={Project:"PicoLotteries",Version:"0.2.0"},angular.element(document).ready(function(){angular.bootstrap(document,["app"])})}();
//# sourceMappingURL=app.min.js.map
