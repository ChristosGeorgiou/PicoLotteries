!function(){"use strict";angular.module("app._common",["lbServices","ngResource","ngSanitize","ngCookies","ui.bootstrap","ui.router","toaster"])}(),function(){"use strict";function routerHelperProvider($locationProvider,$stateProvider,$urlRouterProvider){function RouterHelper($state){function configureStates(states,otherwisePath){states.forEach(function(state){var config={controllerAs:"vm"};angular.extend(config,state.config),config.views&&_.each(config.views,function(item){item.controllerAs="vm"}),$stateProvider.state(state.state,config)}),otherwisePath&&!hasOtherwise&&(hasOtherwise=!0,$urlRouterProvider.otherwise(otherwisePath))}function getStates(){return $state.get()}var hasOtherwise=!1,service={configureStates:configureStates,getStates:getStates};return service}this.$get=RouterHelper,RouterHelper.$inject=["$state"]}angular.module("app._common").provider("routerHelper",routerHelperProvider),routerHelperProvider.$inject=["$locationProvider","$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function modalHelperProvider(){function modalHelper($uibModal,$q){function configureModals(modals){var _ret={};return angular.forEach(modals,function(modal){_ret[modal.modal]=function(obj){function ModalResultComplete(response){return response}function ModalResultFailed(reason){return reason&&"backdrop click"!==reason?$q.reject():void 0}var config={controllerAs:"vm",resolve:{ModalParams:function(){return obj||{}}}};return angular.extend(config,modal.config),$uibModal.open(config).result.then(ModalResultComplete)["catch"](ModalResultFailed)}}),_ret}var service={configureModals:configureModals};return service}this.$get=modalHelper,modalHelper.$inject=["$uibModal","$q"]}angular.module("app._common").provider("modalHelper",modalHelperProvider),modalHelperProvider.$inject=[]}(),function(){"use strict";function configHelperProvider(){function ConfigHelper(){function notifyConfig(configName,message){message=message||{},console.log("%c CONFIG - "+configName+" ","background: #9C27B0; color: #FFF",message)}var service={notifyConfig:notifyConfig};return service}this.$get=ConfigHelper,ConfigHelper.$inject=[]}angular.module("app._common").provider("configHelper",configHelperProvider),configHelperProvider.$inject=[]}(),function(){"use strict";function numberFixedLen(){return function(a,b){return(1e4+a+"").slice(-b)}}angular.module("app._common").filter("numberFixedLen",numberFixedLen),numberFixedLen.$inject=[]}(),function(){"use strict";function fromNow(){return function(date){return moment(date).fromNow()}}angular.module("app._common").filter("fromNow",fromNow),fromNow.$inject=[]}(),function(){"use strict";function fileicon(){var _icons={"application/pdf":"fa-file-pdf-o","application/powerpoint":"fa-file-powerpoint-o","application/x-msword":"fa-file-word-o","application/x-msexcel":"fa-file-excel-o","application/x-mspowerpoint":"fa-file-powerpoint-o","audio/x-mpeg-3":"fa-file-audio-o","image/gif":"fa-file-image-o","image/png":"fa-file-image-o","image/tiff":"fa-file-image-o","image/jpeg":"fa-file-image-o","video/avi":"fa-file-video-o","video/mpeg":"fa-file-video-o","video/msvideo":"fa-file-video-o","video/quicktime":"fa-file-video-o","application/zip":"fa-file-zip-o"};return function(a){return _icons[a]||"fa-file-o"}}angular.module("app._common").filter("fileicon",fileicon),fileicon.$inject=[]}(),function(){"use strict";function bytes(){return function(bytes,precision){if(isNaN(parseFloat(bytes))||!isFinite(bytes))return"-";"undefined"==typeof precision&&(precision=1);var units=["bytes","kB","MB","GB","TB","PB"],number=Math.floor(Math.log(bytes)/Math.log(1024));return(bytes/Math.pow(1024,Math.floor(number))).toFixed(precision)+" "+units[number]}}angular.module("app._common").filter("bytes",bytes),bytes.$inject=[]}(),function(){"use strict";function pwCheck(){return{require:"ngModel",restrict:"A",link:function(scope,elem,attrs,ctrl){var firstPassword="#"+attrs.pwCheck;elem.add(firstPassword).on("keyup",function(){scope.$apply(function(){var v=elem.val()===$(firstPassword).val();ctrl.$setValidity("pwmatch",v)})})}}}angular.module("app._common").directive("pwCheck",pwCheck)}(),function(){"use strict";function ngPrint(){function link(scope,element,attrs){element.on("click",function(){var elemToPrint=document.getElementById(attrs.printElementId);elemToPrint&&printElement(elemToPrint)});var beforePrint=function(){console.log("Functionality to run before printing.")},afterPrint=function(){console.log("Functionality to run after printing"),printSection.innerHTML=""};if(window.matchMedia){var mediaQueryList=window.matchMedia("print");mediaQueryList.addListener(function(mql){mql.matches?beforePrint():afterPrint()})}window.onbeforeprint=beforePrint,window.onafterprint=afterPrint}function printElement(elem){var domClone=elem.cloneNode(!0);printSection.appendChild(domClone),window.print()}var printSection=document.getElementById("printSection");return printSection||(printSection=document.createElement("div"),printSection.id="printSection",document.body.appendChild(printSection)),{link:link,restrict:"A"}}angular.module("app._common").directive("ngPrint",ngPrint)}(),function(){"use strict";function errSrc(){return{link:function(scope,element,attrs){attrs.ngSrc||attrs.$set("src",attrs.errSrc),element.bind("error",function(){return"REMOVE"==attrs.errSrc?void element.remove():void(attrs.src!=attrs.errSrc&&attrs.$set("src",attrs.errSrc))})}}}angular.module("app._common").directive("errSrc",errSrc)}(),function(){"use strict";function ngConfirmClick(){return{priority:-1,restrict:"A",link:function(scope,element,attrs){element.bind("click",function(e){var message=attrs.ngConfirmClick;message&&!confirm(message)&&(e.stopImmediatePropagation(),e.preventDefault())})}}}angular.module("app._common").directive("ngConfirmClick",ngConfirmClick)}(),function(){"use strict";function LocationConfig(configHelperProvider,$locationProvider){$locationProvider.html5Mode(!0),configHelperProvider.$get().notifyConfig("Location HTML5",!0)}angular.module("app._common").config(LocationConfig),LocationConfig.$inject=["configHelperProvider","$locationProvider"]}(),function(){"use strict";function LocationConfig($httpProvider){$httpProvider.defaults.withCredentials=!0}angular.module("app._common").config(LocationConfig),LocationConfig.$inject=["$httpProvider"]}(),function(){"use strict";angular.module("app.settings",[])}(),function(){"use strict";function SettingsController($state,SettingsService,SettingsModals){function activate(){}function ChangePassword(){SettingsModals.ChangePassword().then(function(){$state.go("auth.logout",{ref:"SIGNOUT"})})}var vm=this;vm.ChangePassword=ChangePassword,activate()}angular.module("app.settings").controller("SettingsController",SettingsController),SettingsController.$inject=["$state","SettingsService","SettingsModals"]}(),function(){"use strict";function ChangePasswordController($modalInstance,ModalParams,User,toaster){function activate(){}function Save(){vm.loading=!0,User.prototype$updateAttributes({id:User.getCurrentId(),password:vm.Password}).$promise.then(function(user){toaster.pop("success","Password Changed"),vm.loading=!1,$modalInstance.close()})}var vm=this;vm.Save=Save,activate()}angular.module("app.settings").controller("ChangePasswordController",ChangePasswordController),ChangePasswordController.$inject=["$modalInstance","ModalParams","User","toaster"]}(),function(){"use strict";angular.module("app.plists",[])}(),function(){"use strict";function PlistsController(PlistsService,PlistsModals){function activate(){vm.LoadPlists()}function LoadPlists(params){vm.loading=!0,PlistsService.GetPlists(params).then(function(plists){vm.Plists=plists})["finally"](function(){vm.loading=!1})}function AddPlist(){PlistsModals.PlistForm().then(function(){vm.LoadPlists()})}function ViewPlist(id){PlistsModals.PlistForm({ID:id}).then(function(){vm.LoadPlists()})}var vm=this;vm.AddPlist=AddPlist,vm.ViewPlist=ViewPlist,vm.LoadPlists=LoadPlists,activate()}angular.module("app.plists").controller("PlistsController",PlistsController),PlistsController.$inject=["PlistsService","PlistsModals"]}(),function(){"use strict";function PlistFormController($modalInstance,ModalParams,PlistsService){function activate(){vm.Plist.id&&(vm.loading=!0,PlistsService.GetPlist(vm.Plist.id).then(function(data){vm.Plist=data})["finally"](function(){vm.loading=!1}))}function Save(){vm.loading=!0,PlistsService.SavePlist(vm.Plist).then(function(){vm.loading=!1,$modalInstance.close()})}function Delete(){vm.loading=!0,PlistsService.DeletePlist(vm.Plist.id).then(function(){vm.loading=!1,$modalInstance.close()})}var vm=this;vm.Plist={id:ModalParams.ID||null,Participants:[]},vm.Save=Save,vm.Delete=Delete,activate()}angular.module("app.plists").controller("PlistFormController",PlistFormController),PlistFormController.$inject=["$modalInstance","ModalParams","PlistsService"]}(),function(){"use strict";angular.module("app.lotteries",[])}(),function(){"use strict";function LotteriesController($state,LotteriesService,LotteriesModals){function activate(){vm.LoadLotteries()}function LoadLotteries(){return vm.loading=!0,LotteriesService.GetLotteries().then(function(data){vm.Lotteries=data})["finally"](function(){vm.loading=!1})}function AddLottery(){LotteriesModals.LotteryInit().then(function(id){id&&$state.go("app.lotteries.lottery",{ID:id})})}var vm=this;vm.AddLottery=AddLottery,vm.LoadLotteries=LoadLotteries,activate()}angular.module("app.lotteries").controller("LotteriesController",LotteriesController),LotteriesController.$inject=["$state","LotteriesService","LotteriesModals"]}(),function(){"use strict";function LotteryController($state,LotteriesService,$stateParams){function activate(){vm.LoadLottery()}function LoadLottery(){vm.loading=!0,LotteriesService.GetLottery($stateParams.ID).then(function(data){vm.Lottery=data})["finally"](function(){vm.loading=!1})}function DeleteLottery(){vm.loading=!0,LotteriesService.DeleteLottery(vm.Lottery.id).then(function(){$state.go("app.lotteries.overview")})}var vm=this;vm.LoadLottery=LoadLottery,vm.DeleteLottery=DeleteLottery,activate()}angular.module("app.lotteries").controller("LotteryController",LotteryController),LotteryController.$inject=["$state","LotteriesService","$stateParams"]}(),function(){"use strict";function LotteryInitController($modalInstance,ModalParams,LotteriesService,PlistsService){function activate(){vm.LoadPlists()}function LoadPlists(){vm.loading=!0,PlistsService.GetPlists().then(function(data){vm.Plists=data})["finally"](function(){vm.loading=!1})}function Save(){LotteriesService.SaveLottery(vm.Lottery).then(function(resp){$modalInstance.close(resp.id)})}var vm=this;vm.Lottery={Name:"Lottery #"+(new Date).getTime()},vm.LoadPlists=LoadPlists,vm.Save=Save,activate()}angular.module("app.lotteries").controller("LotteryInitController",LotteryInitController),LotteryInitController.$inject=["$modalInstance","ModalParams","LotteriesService","PlistsService"]}(),function(){"use strict";angular.module("app.auth",[])}(),function(){"use strict";function AuthLoginController($stateParams,$state,LoginMessages,User){function activate(){$stateParams.ref&&SignMessage($stateParams.ref.toUpperCase())}function SignIn(){vm.loading=!0,vm.Alert=!1,User.login(angular.copy(vm.credentials)).$promise.then(function(response){$state.go("app.lotteries.overview")},function(rejection){SignMessage(rejection.data.error.code.toUpperCase())})["finally"](function(){vm.credentials.password=null,vm.loading=!1})}function SignMessage(code){vm.Alert=LoginMessages[code]}var vm=this;vm.loading=!1,vm.SignIn=SignIn,activate()}angular.module("app.auth").controller("AuthLoginController",AuthLoginController),AuthLoginController.$inject=["$stateParams","$state","LoginMessages","User"]}(),function(){"use strict";function RoutesConfig(configHelper,routerHelper){var _states=getStates();routerHelper.configureStates(_states,"/"),configHelper.notifyConfig("Basic Routes",_.map(_states,function(_state){return _state.state}))}function getStates(){return[{state:"app",config:{"abstract":!0,templateUrl:"src/_common/views/layout.html",controller:function($scope,User){User.getCurrent().$promise.then(function(u){$scope.username=u.username})}}}]}angular.module("app._common").run(RoutesConfig),RoutesConfig.$inject=["configHelper","routerHelper"]}(),function(){"use strict";function SettingsService($resource){function GetSettings(params){return $resource(APP.Service+"_design/models/_view/Settings").get().$promise.then(function(data){return _.chain(data.rows).map(function(item){return item.value}).sortBy(function(item){return item.DrewAt||0}).reverse().value()})}function GetSetting(id){return $resource(APP.Service+id).get().$promise.then(function(data){return data})}function SaveSetting(Setting){return Setting.Type="Setting",$resource(APP.Service).save(Setting).$promise.then(function(data){return data})}function DeleteSetting(Setting){return Setting._deleted=!0,Setting.DeletedAt=new Date,$resource(APP.Service).save(Setting).$promise}var service={GetSettings:GetSettings,GetSetting:GetSetting,SaveSetting:SaveSetting,DeleteSetting:DeleteSetting};return service}angular.module("app.settings").factory("SettingsService",SettingsService),SettingsService.$inject=["$resource"]}(),function(){"use strict";function appRun(routerHelper){routerHelper.configureStates(getStates())}function getStates(){return[{state:"app.settings",config:{url:"/settings",controller:"SettingsController",templateUrl:"src/settings/overview/view.html"}}]}angular.module("app.settings").run(appRun),appRun.$inject=["routerHelper"]}(),function(){"use strict";function SettingsModals(modalHelper){function getModals(){return[{modal:"ChangePassword",config:{templateUrl:"src/settings/changepassword/view.html",controller:"ChangePasswordController",size:"sm"}}]}return modalHelper.configureModals(getModals())}angular.module("app.lotteries").factory("SettingsModals",SettingsModals),SettingsModals.$inject=["modalHelper"]}(),function(){"use strict";function PlistsService($resource,Plist){function GetPlists(params){var params=params||{};return Plist.find({filter:{order:params.order||"CreatedAt DESC"}}).$promise.then(function(data){return data})}function GetPlist(id){return Plist.findById({id:id}).$promise.then(function(item){return item})}function SavePlist(plist){return plist.id||(plist.CreatedAt=new Date),Plist.updateOrCreate(plist).$promise.then(function(item){return item})}function DeletePlist(id){return Plist.deleteById({id:id}).$promise.then(function(item){return item})}var service={GetPlists:GetPlists,GetPlist:GetPlist,SavePlist:SavePlist,DeletePlist:DeletePlist};return service}angular.module("app.plists").factory("PlistsService",PlistsService),PlistsService.$inject=["$resource","Plist"]}(),function(){"use strict";function appRun(routerHelper){routerHelper.configureStates(getStates())}function getStates(){return[{state:"app.plists",config:{url:"/plists",controller:"PlistsController",templateUrl:"src/plists/overview/view.html"}}]}angular.module("app.plists").run(appRun),appRun.$inject=["routerHelper"]}(),function(){"use strict";function PlistsModals(modalHelper){function getModals(){return[{modal:"PlistForm",config:{templateUrl:"src/plists/form/view.html",controller:"PlistFormController",size:"md",backdrop:"static"}}]}return modalHelper.configureModals(getModals())}angular.module("app.plists").factory("PlistsModals",PlistsModals),PlistsModals.$inject=["modalHelper"]}(),function(){"use strict";function LotteriesService($resource,Lottery){function GetLotteries(params){var params=params||{};return Lottery.find({filter:{order:params.order||"CreatedAt DESC"}}).$promise.then(function(data){return data})}function GetLottery(id){return Lottery.findById({id:id}).$promise.then(function(item){return item})}function SaveLottery(lottery){return lottery.DrewAt=new Date,Lottery.create(lottery).$promise.then(function(item){return item})}function DeleteLottery(id){return Lottery.deleteById({id:id}).$promise.then(function(item){return item})}var service={GetLotteries:GetLotteries,GetLottery:GetLottery,SaveLottery:SaveLottery,DeleteLottery:DeleteLottery};return service}angular.module("app.lotteries").factory("LotteriesService",LotteriesService),LotteriesService.$inject=["$resource","Lottery"]}(),function(){"use strict";function appRun(routerHelper){routerHelper.configureStates(getStates())}function getStates(){return[{state:"app.lotteries",config:{"abstract":!0,template:"<ui-view/>"}},{state:"app.lotteries.overview",config:{url:"/",controller:"LotteriesController",templateUrl:"src/lotteries/overview/view.html"}},{state:"app.lotteries.lottery",config:{url:"/lottery/:ID",controller:"LotteryController",templateUrl:"src/lotteries/lottery/view.html"}}]}angular.module("app.lotteries").run(appRun),appRun.$inject=["routerHelper"]}(),function(){"use strict";function LotteriesModals(modalHelper){function getModals(){return[{modal:"LotteryInit",config:{templateUrl:"src/lotteries/init/view.html",controller:"LotteryInitController",size:"sm"}}]}return modalHelper.configureModals(getModals())}angular.module("app.lotteries").factory("LotteriesModals",LotteriesModals),LotteriesModals.$inject=["modalHelper"]}(),function(){"use strict";function appRun(routerHelper){routerHelper.configureStates(getStates())}function getStates(){return[{state:"auth",config:{"abstract":!0,template:"<ui-view/>"}},{state:"auth.login",config:{url:"/login",params:{ref:null},templateUrl:"src/auth/login/view.html",controller:"AuthLoginController"}},{state:"auth.logout",config:{url:"/logout",template:"<ui-view/>",controller:function(User,$state){User.logout().$promise.then(function(){})["finally"](function(){localStorage.clear(),$state.go("auth.login",{ref:"SIGNOUT"})})}}}]}angular.module("app.auth").run(appRun),appRun.$inject=["routerHelper"]}(),function(){"use strict";function AuthInterceptor($q,$injector,$cookies){return{responseError:function(rejection){if(console.log("rejection",rejection),401===rejection.status&&"/api/Users/login"!=rejection.config.url){localStorage.clear();var $state=$injector.get("$state");$state.go("auth.login",{ref:"SESSIONEND"})}return $q.reject(rejection)}}}function AuthInterceptorConfig($httpProvider){$httpProvider.interceptors.push("AuthInterceptor")}angular.module("app.auth").config(AuthInterceptorConfig).factory("AuthInterceptor",AuthInterceptor),AuthInterceptor.$inject=["$q","$injector","$cookies"],AuthInterceptorConfig.$inject=["$httpProvider"]}(),function(){"use strict";angular.module("app.auth").constant("LoginMessages",{SESSIONEND:{Type:"danger",Message:"You were signed out",Details:"Probably your session was timed out"},SIGNOUT:{Type:"success",Message:"You were signed out",Details:"You may login again using the form"},REGISTERED:{Type:"success",Message:"Your account is ready, you can login now",Details:!1},AUTHERROR:{Type:"danger",Message:"Authentication Error",Details:null},UNAVAILABLE:{Type:"danger",Message:"Service is not available",Details:"Please try again later. If the problem insist, contact your system administrator"},LOGIN_FAILED:{Type:"danger",Message:"Name or password is incorrect",Details:"Please try again"}})}(),function(){"use strict";angular.module("app",["app.auth","app.lotteries","app.plists","app.settings","app._common"])}(),function(){"use strict";function appRun($rootScope,$state,$stateParams){$rootScope.APP=APP,$rootScope.$on("$stateChangeStart",function(evt,to,params){to.redirectTo&&(evt.preventDefault(),$state.go(to.redirectTo,params))})}angular.module("app").run(appRun),appRun.$inject=["$rootScope","$state","$stateParams"]}(),function(){window.APP={name:"Lotteries",description:"Make simple lotteries draws",version:"0.4.1",repository:"https://github.com/ChristosGeorgiou/lotteries.git",author:{name:"Christos Georgiou",email:"xris.georgiou@gmail.com",url:"http://christosgeorgiou.gr"}}}();
//# sourceMappingURL=app.min.js.map
